@page "/respond/{id:guid}"

<PageTitle>Proposal Response - Dungeon Dates</PageTitle>

@if (_response is null)
{
    <MudProgressLinear Color="Color.Primary" Indeterminate="true" Class="my-7"/>
}
else
{
    <MudGrid Spacing="2">
        <MudItem xs="12" Class="px-4">
            <MudText Typo="Typo.h3" Color="Color.Primary" Align="Align.Center">Proposal Response</MudText>
        </MudItem>
        <img src="/divider.png" alt="Fancy divider" class="fantasy-divider py-1" />
        <MudItem xs="12" Class="py-2 px-4">
            <MudAlert Severity="Severity.Info" ShowCloseIcon="false">
                Enter your name and then answer whether you are available for each of the given date(s) below.
            </MudAlert>
        </MudItem>
        <MudItem xs="12" Class="px-4">
            @if (_response.NoDatesWork)
            {
                <MudAlert Severity="Severity.Error" ShowCloseIcon="false">
                    Alas, the stars refuse to align - none of these dates please all the adventurers. <MudLink Href="/add" Color="Color.Error" Style="font-weight: bolder">Summon new dates?</MudLink>
                </MudAlert>
            }
        </MudItem>
        <MudItem xs="12" Class="px-4">
            <MudTextField Label="Your Name" @bind-Value=@_name Variant="Variant.Outlined" Placeholder="Drizzt Do'Urden"/>
        </MudItem>
        <MudItem xs="12" Class="px-4">
            <MudGrid Spacing="2">
                @foreach (var proposedDate in _response.ProposedDates)
                {
                    <MudItem xs="12" md="6" lg="4">
                        <MudCard Style="background-color: transparent;" Elevation="0" Outlined="true">
                            <MudCardHeader>
                                <CardHeaderContent>
                                    <MudStack Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center" Row="true" Spacing="0">
                                        <MudText Typo="Typo.h4" Color="Color.Primary" GutterBottom="false">@proposedDate.StartDate.ToString("ddd | MMM dd yyyy")</MudText>
                                        <MudText Typo="Typo.h4" Color="Color.Primary" GutterBottom="false">
                                            @($"{proposedDate.AcceptedResponseCount} | {proposedDate.TotalResponseCount}")
                                        </MudText>
                                    </MudStack>
                                </CardHeaderContent>
                            </MudCardHeader>
                            <MudCardContent>
                                @foreach (var response in proposedDate.Responses)
                                {
                                    @if (response.Accepted)
                                    {
                                        <MudChip T="string" Icon="@Icons.Material.Filled.Check" Color="Color.Success" Size="Size.Large" Variant="Variant.Outlined">@response.Name</MudChip>
                                    }
                                    else
                                    {
                                        <MudChip T="string" Icon="@Icons.Material.Filled.Cancel" Color="Color.Error" Size="Size.Large" Variant="Variant.Outlined">@response.Name</MudChip>
                                    }
                                }
                            </MudCardContent>
                            <MudCardActions>
                                @if (!_formHasBeenSubmitted)
                                {
                                    <MudToggleIconButton Color="Color.Error" Icon="@Icons.Material.Filled.Close" Variant="Variant.Filled"
                                                         ToggledIcon="@Icons.Material.Filled.Check" ToggledColor="Color.Success" ToggledVariant="Variant.Filled"
                                                         ToggledChanged="() => OnProposedDateClick(proposedDate)" Size="Size.Large" Style="width: 100%"/>
                                }
                            </MudCardActions>
                        </MudCard>
                    </MudItem>
                }
            </MudGrid>
        </MudItem>
        @if (!_formHasBeenSubmitted)
        {
            <MudItem xs="12">
                <MudButton OnClick="OnSaveClickedAsync" Color="Color.Primary" Variant="Variant.Filled" Size="Size.Large" FullWidth="true" Disabled="_isLoading">
                    <MudText Typo="Typo.h4" GutterBottom="false" Color="Color.Secondary">
                        @if (_isLoading)
                        {
                            <span>Saving...</span>
                        }
                        else
                        {
                            <span>Save</span>
                        }
                    </MudText>
                </MudButton>
            </MudItem>
        }
    </MudGrid>
    <img src="/divider.png" alt="Fancy divider" class="fantasy-divider py-2" />
}

